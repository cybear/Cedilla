<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ç - a canvas micro library</title>
<style>
img{border:1px solid white;padding:0px;margin:10px;background-color:#fff}
</style>
</head>
<body style="background:#ffe">
<script src="../lib/require.js"></script>
<script>
require(
  {baseUrl:'../lib/'},
  ['ç', 'loadimages', 'histogram'],
  function(ç, loadimages){
    "use strict";
    var urls=['Lenna.png'];

    ç.prototype.drawHistogram = function(histogram, color, fill){
      // todo: color channels should share "max" not have their own "max"
      var h = this.h,
        max = [].slice.call(histogram).sort(function(a,b){return b-a;})[0],
        factor = 1 / max * h,
        cx = this.cx;

      cx.lineWidth=0.5;
      cx.strokeStyle = color;
      cx.beginPath();
      cx.moveTo(0.5, h);

      histogram.forEach(function(val, i){
        val *=factor;
        if(val>h) val=h;
        if(fill)cx.moveTo(i+0.5, h);
        cx.lineTo(i+0.5,h-val);
      });
      cx.stroke();
    };

    loadimages(urls, function(imgs){
      var img = imgs[0], 
        myCanvas=ç(img),
        histograph=ç(256, 100),
        histograph_data = histograph.getData(),
        histograms = myCanvas.histogram();
      for(var key in histograms){
        if(key!=='alpha' && key!=='luminance'){
          var histogram=histograms[key];
          var color = {
            red:'rgba(255,0,0,1)',
            green:'rgba(0,255,0,1)',
            blue:'rgba(0,0,255,1)'
          }[key];
          histograph.cx.globalAlpha='0.2';
          histograph.drawHistogram(histogram, color, true);
          histograph.cx.globalAlpha='1';
          histograph.drawHistogram(histogram, color);
        }
      }
      document.body.appendChild(histograph.el);
    });
});
</script>
</body>
</html>
